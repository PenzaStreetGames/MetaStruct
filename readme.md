# MetaStruct

JIT-ускоритель программ на языке Python

## Алгоритм

1. Программа переводится в абстрактное синтаксическое дерево (АСТ) с помощью модуля питона `ast`
2. По дереву строится текст программы на языке C++
3. Программа на C++ компилируется в динамическую библиотеку .dll
4. DLL-библиотека загружается в Python с помощью модуля `ctypes`
5. С помощью аннотации `@jit` функция на языке Python заменяется её скомпилированным вариантом


## Требования к программам

* Python версии 3.9 и выше
* Компилятор `g++`

Также желательно, чтобы скрипт в папке исполнения имел права на чтение и запись файлов, либо был запущен от
имени администратора.

## Пример

Допустим, есть алгоритм, вычисляющий значение функции в точке, при известной производной и разложении 
в ряд Тейлора. Для примера возьмём функцию экспоненты.

```python
from annotation import jit

@jit
def jit_exp(x: float) -> float:
    res: float = 0
    threshold: float = 1e-30
    delta: float = 1
    elements: int = 0
    while delta > threshold:
        elements = elements + 1
        delta = delta * x / elements
    while elements >= 0:
        res += delta
        delta = delta * elements / x
        elements -= 1
    return res
```

В примере выше выполняется вычисление производной по формуле:
$e^x = \displaystyle\sum_{n=0}^\infty \frac{x^n}{n!}$

Следует отметить, что в алгоритме суммирование происходит от самого маленького члена к самому большому
(справа налево), что позволяет не терять точность при сложении больших чисел с маленькими.

Показанная выше функция будет преобразована к такому эквиваленту на языке C++:

```cpp
extern "C" double jit_exp(double x) {
    double res = 0;
    double threshold = 1e-30;
    double delta = 1;
    int elements = 0;
    while ((delta > threshold)) {
        elements = (elements + 1);
        delta = ((delta * x) / elements);
    }
    while ((elements >= 0)) {
        res += delta;
        delta = ((delta * elements) / x);
        elements -= 1;
    }
    return res;
}
```

Избыточность некоторых скобок объясняется автогенерацией кода.

## Ограничения по синтаксису

* Все переменные 

```
Текст программы на языке Python 
-> (модуль python.ast) ->
абстрактно-синтаксическое дерево Python 
-> (модуль MetaStruct) ->
абстрактно-синтаксическое дерево C++ 
-> (модуль MetaStruct) ->
Текст программы на языке C++
```

Требуется также модуль для тестирования программ, работающий по алгоритму:

1. Компиляция программы C++
2. Запуск программы на Питон
3. Запуск программы на C++
4. Сравнение результатов работы двух программ с тестами
5. Вывод результата

## Возможности

### Стадия I

Компиляция линейных программ, операции над целыми числами.

(?) Базовый ввод-вывод (print, input)

## Текущая разработка (08.04.2022)

* Модуль тестирования
* Оптимизация структуры проекта
* Исполнение .cpp (сборка .exe из .cpp)
* Документирование